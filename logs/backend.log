
> server-backup-web@1.0.0 dev:server
> PORT=${PORT:-3010} nodemon --watch src/server --exec tsx src/server/index.ts

[33m[nodemon] 3.1.11[39m
[33m[nodemon] to restart at any time, enter `rs`[39m
[33m[nodemon] watching path(s): src/server/**/*[39m
[33m[nodemon] watching extensions: ts,json[39m
[32m[nodemon] starting `tsx src/server/index.ts`[39m
Database connection established
Server running at http://localhost:3010
[Cron] Loading cron jobs from database...
[Cron] Stopped all jobs
[Cron] Scheduled job 1 (daily backup 2 AM) with expression: 8 10 * * *
[Cron] Loaded 1 cron job(s)
[Cron] Stopped job 1
[Cron] Scheduled job 1 (daily backup 2 AM) with expression: 40 15 * * *
[Cron] Executing backup job 1 for server all
[Backup 55] Using server-specific local backup path: /opt/backup
[Backup 56] Using server-specific local backup path: /opt/backup
[Cron] Backup job 1 completed successfully
[Backup 55] Starting backup process...
[Backup 55] Creating remote directory: /tmp/backup_2025-12-09_xTerminal
[Backup 56] Starting backup process...
[Backup 56] Creating remote directory: /tmp/backup_2025-12-09_local_backups
[Backup 56] Skipping /var/www backup
[Backup 56] Skipping /var/log backup
[Backup 56] Skipping /etc/nginx backup
[Backup 56] Compressing /var/www/html/backup/bk...
[Backup 56] STDERR: tar: Removing leading `/' from member names

[Backup 55] Compressing /var/www...
[Backup 55] STDERR: tar: Removing leading `/' from member names

[Backup 56] Dumping all databases...
[Backup 56] STDERR: mysqldump: [Warning] Using a password on the command line interface can be insecure.

[Backup 56] STDERR: mysqldump: Error: 'Access denied; you need (at least one of) the PROCESS privilege(s) for this operation' when trying to dump tablespaces

[Backup 56] Rsyncing to local: /opt/backup/backup_2025-12-09_local_backups
[Backup 56] Local Error: Command failed: rsync -az --partial -e "sshpass -p '@dminkaka' ssh -o StrictHostKeyChecking=no -o PreferredAuthentications=password -p 22" root@10.240.150.158:/tmp/backup_2025-12-09_local_backups/ /opt/backup/backup_2025-12-09_local_backups/
rsync: [Receiver] Failed to exec sshpass: No such file or directory (2)
rsync error: error in IPC code (code 14) at pipe.c(85) [Receiver=3.2.7]
rsync: connection unexpectedly closed (0 bytes received so far) [Receiver]
rsync error: error in IPC code (code 14) at io.c(232) [Receiver=3.2.7]

[Backup 56] Rsync failed, falling back to SFTP
[Backup 56] Starting SFTP transfer from /tmp/backup_2025-12-09_local_backups to /opt/backup/backup_2025-12-09_local_backups
[Backup 56] SFTP Connection ready
[Backup 56] Found 2 files to transfer via SFTP
[Backup 56] SFTP downloading: local_backups_custom__var_www_html_backup_bk.tar.gz
[Cron] Executing backup job 1 for server all
[Backup 57] Using server-specific local backup path: /opt/backup
[Backup 58] Using server-specific local backup path: /opt/backup
[Cron] Backup job 1 completed successfully
[Backup 57] Starting backup process...
[Backup 57] Creating remote directory: /tmp/backup_2025-12-09_xTerminal
[Backup 58] Starting backup process...
[Backup 58] Creating remote directory: /tmp/backup_2025-12-09_local_backups
[Backup 56] SFTP downloading: local_backups_db-dump-all.sql
[Backup 56] SFTP transfer completed successfully
[Backup 56] Cleaning up remote files...
[Backup 57] Compressing /var/www...
[Backup 58] Skipping /var/www backup
[Backup 58] Skipping /var/log backup
[Backup 58] Skipping /etc/nginx backup
[Backup 58] Compressing /var/www/html/backup/bk...
[Backup 56] Backup completed successfully.
[Backup 56] Starting Google Drive auto-upload for backup directory...
Initializing Drive service with refresh token length: 103
[Backup 56] Drive target folder: root
[Backup 58] STDERR: tar: Removing leading `/' from member names
tar (child): /tmp/backup_2025-12-09_local_backups/local_backups_custom__var_www_html_backup_bk.tar.gz: Cannot open: No such file or directory
tar (child): Error is not recoverable: exiting now

[Backup 58] STDERR: tar: /tmp/backup_2025-12-09_local_backups/local_backups_custom__var_www_html_backup_bk.tar.gz: Cannot write: Broken pipe
tar: Child returned status 2
tar: Error is not recoverable: exiting now

[Backup 58] Backup failed: Command failed with code 2
Error: Command failed with code 2
    at Channel.<anonymous> (/var/www/html/backup/bk/src/server/backup.ts:58:36)
    at Channel.emit (node:events:529:35)
    at Channel.doClose (/var/www/html/backup/bk/node_modules/ssh2/lib/utils.js:101:21)
    at Object.onceWrapper (node:events:631:28)
    at Channel.emit (node:events:529:35)
    at endReadableNT (node:internal/streams/readable:1400:12)
    at process.processTicksAndRejections (node:internal/process/task_queues:82:21)
[Backup 57] STDERR: tar: Removing leading `/' from member names

Drive authentication successful
[Backup 55] Compressing /var/log...
[Backup 55] STDERR: tar: Removing leading `/' from member names

[Backup 57] Compressing /var/log...
[Backup 57] STDERR: tar: Removing leading `/' from member names

[Backup 55] Compressing /etc/nginx...
[Backup 55] STDERR: tar: 
[Backup 55] STDERR: Removing leading `/' from member names
[Backup 55] STDERR: 

[Backup 55] Compressing /var/www/html/xTerminal...
[Backup 55] STDERR: tar: Removing leading `/' from member names

[Backup 57] Compressing /etc/nginx...
[Backup 57] STDERR: tar: Removing leading `/' from member names

[Backup 57] Compressing /var/www/html/xTerminal...
[Backup 57] STDERR: tar: Removing leading `/' from member names

[Backup 55] Dumping selected databases: xTerminal
[Backup 55] DEBUG: dbSelected array: ["xTerminal"]
[Backup 55] Dumping database: xTerminal
[Backup 55] DEBUG: Executing mysqldump for xTerminal
[Backup 55] Rsyncing to local: /opt/backup/backup_2025-12-09_xTerminal
[Backup 55] Local Error: Command failed: rsync -az --partial -e "sshpass -p '@dminkaka' ssh -o StrictHostKeyChecking=no -o PreferredAuthentications=password -p 22" root@10.240.150.156:/tmp/backup_2025-12-09_xTerminal/ /opt/backup/backup_2025-12-09_xTerminal/
rsync: [Receiver] Failed to exec sshpass: No such file or directory (2)
rsync error: error in IPC code (code 14) at pipe.c(85) [Receiver=3.2.7]
rsync: [Receiver] safe_write failed to write 4 bytes to socket: Broken pipe (32)
rsync error: error in IPC code (code 14) at io.c(327) [Receiver=3.2.7]

[Backup 55] Rsync failed, falling back to SFTP
[Backup 55] Starting SFTP transfer from /tmp/backup_2025-12-09_xTerminal to /opt/backup/backup_2025-12-09_xTerminal
[Backup 57] Dumping selected databases: xTerminal
[Backup 57] DEBUG: dbSelected array: ["xTerminal"]
[Backup 57] Dumping database: xTerminal
[Backup 57] DEBUG: Executing mysqldump for xTerminal
[Backup 55] SFTP Connection ready
[Backup 55] Found 5 files to transfer via SFTP
[Backup 55] SFTP downloading: xTerminal_nginx_bak.tar.gz
[Backup 55] SFTP downloading: xTerminal_www_bak.tar.gz
[Backup 57] Rsyncing to local: /opt/backup/backup_2025-12-09_xTerminal
[Backup 57] Local Error: Command failed: rsync -az --partial -e "sshpass -p '@dminkaka' ssh -o StrictHostKeyChecking=no -o PreferredAuthentications=password -p 22" root@10.240.150.156:/tmp/backup_2025-12-09_xTerminal/ /opt/backup/backup_2025-12-09_xTerminal/
rsync: [Receiver] Failed to exec sshpass: No such file or directory (2)
rsync error: error in IPC code (code 14) at pipe.c(85) [Receiver=3.2.7]
rsync: [Receiver] safe_write failed to write 4 bytes to socket: Broken pipe (32)
rsync error: error in IPC code (code 14) at io.c(327) [Receiver=3.2.7]

[Backup 57] Rsync failed, falling back to SFTP
[Backup 57] Starting SFTP transfer from /tmp/backup_2025-12-09_xTerminal to /opt/backup/backup_2025-12-09_xTerminal
[Backup 57] SFTP Connection ready
[Backup 57] Found 5 files to transfer via SFTP
[Backup 57] SFTP downloading: xTerminal_nginx_bak.tar.gz
[Backup 57] SFTP downloading: xTerminal_www_bak.tar.gz
[Backup 55] SFTP downloading: xTerminal_db-xTerminal.sql
[Backup 55] SFTP downloading: xTerminal_logs_bak.tar.gz
[Backup 57] SFTP downloading: xTerminal_db-xTerminal.sql
[Backup 55] SFTP downloading: xTerminal_custom__var_www_html_xTerminal.tar.gz
[Backup 57] SFTP downloading: xTerminal_logs_bak.tar.gz
[Backup 55] SFTP transfer completed successfully
[Backup 55] Cleaning up remote files...
[Backup 55] Backup completed successfully.
[Backup 55] Starting Google Drive auto-upload for backup directory...
Initializing Drive service with refresh token length: 103
[Backup 55] Drive target folder: root
[Backup 57] SFTP downloading: xTerminal_custom__var_www_html_xTerminal.tar.gz
[Backup 57] SFTP failed to download xTerminal_custom__var_www_html_xTerminal.tar.gz: No such file
[Backup 57] SFTP transfer loop error: No such file
[Backup 57] Backup failed: No such file
Error: No such file
    at 101 (/var/www/html/backup/bk/node_modules/ssh2/lib/protocol/SFTP.js:2854:19)
    at SFTP.push (/var/www/html/backup/bk/node_modules/ssh2/lib/protocol/SFTP.js:278:11)
    at CHANNEL_DATA (/var/www/html/backup/bk/node_modules/ssh2/lib/client.js:585:23)
    at 94 (/var/www/html/backup/bk/node_modules/ssh2/lib/protocol/handlers.misc.js:930:16)
    at Protocol.onPayload (/var/www/html/backup/bk/node_modules/ssh2/lib/protocol/Protocol.js:2059:10)
    at AESGCMDecipherBinding.decrypt (/var/www/html/backup/bk/node_modules/ssh2/lib/protocol/crypto.js:1086:26)
    at Protocol.parsePacket [as _parse] (/var/www/html/backup/bk/node_modules/ssh2/lib/protocol/Protocol.js:2028:25)
    at Protocol.parse (/var/www/html/backup/bk/node_modules/ssh2/lib/protocol/Protocol.js:313:16)
    at Socket.<anonymous> (/var/www/html/backup/bk/node_modules/ssh2/lib/client.js:773:21)
    at Socket.emit (node:events:517:28) {
  code: 2
}
Drive authentication successful
[Backup 55] Using yearly Drive folder: ServerBackups_2025 (1QFA3LAamCNpM4Ep-BOyO7MSPDchUdCgm)
[Backup 55] Found 5 top-level entries to upload from /opt/backup/backup_2025-12-09_xTerminal
Drive authentication successful
Drive authentication successful
[Backup 55] Drive upload 1/5: xTerminal_custom__var_www_html_xTerminal.tar.gz
Drive authentication successful
[Cron] Executing backup job 1 for server all
[Backup 59] Using server-specific local backup path: /opt/backup
[Backup 60] Using server-specific local backup path: /opt/backup
[Cron] Backup job 1 completed successfully
[Backup 59] Starting backup process...
[Backup 59] Creating remote directory: /tmp/backup_2025-12-09_xTerminal
[Backup 60] Starting backup process...
[Backup 60] Creating remote directory: /tmp/backup_2025-12-09_local_backups
[Backup 59] Compressing /var/www...
[Backup 60] Skipping /var/www backup
[Backup 60] Skipping /var/log backup
[Backup 60] Skipping /etc/nginx backup
[Backup 60] Compressing /var/www/html/backup/bk...
[Backup 59] STDERR: tar: Removing leading `/' from member names

[Backup 60] STDERR: tar: Removing leading `/' from member names

[Backup 60] Dumping all databases...
[Backup 60] STDERR: mysqldump: [Warning] Using a password on the command line interface can be insecure.

[Backup 60] STDERR: mysqldump: Error: 'Access denied; you need (at least one of) the PROCESS privilege(s) for this operation' when trying to dump tablespaces

[Backup 60] Rsyncing to local: /opt/backup/backup_2025-12-09_local_backups
[Backup 60] Local Error: Command failed: rsync -az --partial -e "sshpass -p '@dminkaka' ssh -o StrictHostKeyChecking=no -o PreferredAuthentications=password -p 22" root@10.240.150.158:/tmp/backup_2025-12-09_local_backups/ /opt/backup/backup_2025-12-09_local_backups/
rsync: [Receiver] Failed to exec sshpass: No such file or directory (2)
rsync error: error in IPC code (code 14) at pipe.c(85) [Receiver=3.2.7]
rsync: connection unexpectedly closed (0 bytes received so far) [Receiver]
rsync error: error in IPC code (code 14) at io.c(232) [Receiver=3.2.7]

[Backup 60] Rsync failed, falling back to SFTP
[Backup 60] Starting SFTP transfer from /tmp/backup_2025-12-09_local_backups to /opt/backup/backup_2025-12-09_local_backups
[Backup 60] SFTP Connection ready
[Backup 60] Found 2 files to transfer via SFTP
[Backup 60] SFTP downloading: local_backups_custom__var_www_html_backup_bk.tar.gz
[Backup 60] SFTP downloading: local_backups_db-dump-all.sql
[Backup 60] SFTP transfer completed successfully
[Backup 60] Cleaning up remote files...
[Backup 60] Backup completed successfully.
[Backup 60] Starting Google Drive auto-upload for backup directory...
Initializing Drive service with refresh token length: 103
[Backup 60] Drive target folder: root
Drive authentication successful
[Backup 60] Using yearly Drive folder: ServerBackups_2025 (1QFA3LAamCNpM4Ep-BOyO7MSPDchUdCgm)
[Backup 60] Found 2 top-level entries to upload from /opt/backup/backup_2025-12-09_local_backups
Drive authentication successful
Drive authentication successful
[Backup 60] Drive upload 1/2: local_backups_custom__var_www_html_backup_bk.tar.gz
Drive authentication successful
[Backup 59] Compressing /var/log...
[Backup 59] STDERR: tar: Removing leading `/' from member names

[Backup 60] Drive upload 2/2: local_backups_db-dump-all.sql
Drive authentication successful
[Backup 60] Google Drive auto-upload completed successfully. Uploaded items: 3
[Backup 59] Compressing /etc/nginx...
[Backup 59] STDERR: tar: Removing leading `/' from member names

[Backup 59] Compressing /var/www/html/xTerminal...
[Backup 59] STDERR: tar: 
[Backup 59] STDERR: Removing leading `/' from member names

[Backup 59] Dumping selected databases: xTerminal
[Backup 59] DEBUG: dbSelected array: ["xTerminal"]
[Backup 59] Dumping database: xTerminal
[Backup 59] DEBUG: Executing mysqldump for xTerminal
[Backup 59] Rsyncing to local: /opt/backup/backup_2025-12-09_xTerminal
[Backup 59] Local Error: Command failed: rsync -az --partial -e "sshpass -p '@dminkaka' ssh -o StrictHostKeyChecking=no -o PreferredAuthentications=password -p 22" root@10.240.150.156:/tmp/backup_2025-12-09_xTerminal/ /opt/backup/backup_2025-12-09_xTerminal/
rsync: [Receiver] Failed to exec sshpass: No such file or directory (2)
rsync error: error in IPC code (code 14) at pipe.c(85) [Receiver=3.2.7]
rsync: connection unexpectedly closed (0 bytes received so far) [Receiver]
rsync error: error in IPC code (code 14) at io.c(232) [Receiver=3.2.7]

[Backup 59] Rsync failed, falling back to SFTP
[Backup 59] Starting SFTP transfer from /tmp/backup_2025-12-09_xTerminal to /opt/backup/backup_2025-12-09_xTerminal
[Backup 59] SFTP Connection ready
[Backup 59] Found 5 files to transfer via SFTP
[Backup 59] SFTP downloading: xTerminal_nginx_bak.tar.gz
[Backup 59] SFTP downloading: xTerminal_www_bak.tar.gz
[Backup 59] SFTP downloading: xTerminal_db-xTerminal.sql
[Backup 59] SFTP downloading: xTerminal_logs_bak.tar.gz
[Backup 59] SFTP downloading: xTerminal_custom__var_www_html_xTerminal.tar.gz
[Backup 59] SFTP transfer completed successfully
[Backup 59] Cleaning up remote files...
[Backup 59] Backup completed successfully.
[Backup 59] Starting Google Drive auto-upload for backup directory...
Initializing Drive service with refresh token length: 103
[Backup 59] Drive target folder: root
Drive authentication successful
[Backup 56] Using yearly Drive folder: ServerBackups_2025 (1QFA3LAamCNpM4Ep-BOyO7MSPDchUdCgm)
[Backup 56] Found 2 top-level entries to upload from /opt/backup/backup_2025-12-09_local_backups
Drive authentication successful
Drive authentication successful
[Backup 56] Drive upload 1/2: local_backups_custom__var_www_html_backup_bk.tar.gz
Drive authentication successful
[Backup 56] Drive upload 2/2: local_backups_db-dump-all.sql
Drive authentication successful
Failed to upload xTerminal_custom__var_www_html_xTerminal.tar.gz: Error: Failed to upload file: request to https://www.googleapis.com/upload/drive/v3/files?fields=id%2Cname%2CmimeType%2Csize%2CmodifiedTime%2Cparents%2CwebViewLink&uploadType=multipart failed, reason: connect ETIMEDOUT 172.217.169.234:443
    at GoogleDriveService.uploadFile (/var/www/html/backup/bk/src/server/drive.ts:196:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at GoogleDriveService.uploadDirectory (/var/www/html/backup/bk/src/server/drive.ts:287:34)
    at BackupManager.run (/var/www/html/backup/bk/src/server/backup.ts:329:42)
[Backup 55] Drive upload 2/5: xTerminal_db-xTerminal.sql
Drive authentication successful
[Backup 55] Drive upload 3/5: xTerminal_logs_bak.tar.gz
Drive authentication successful
[Backup 55] Drive upload 4/5: xTerminal_nginx_bak.tar.gz
Drive authentication successful
Saving settings: {
  hasGlobalPath: false,
  hasDriveClientId: true,
  hasDriveClientSecret: true,
  hasDriveRefreshToken: true,
  refreshTokenLength: 103,
  hasDriveFolderId: false,
  driveAutoUpload: true
}
Settings updated successfully
Drive test - Config check: {
  hasClientId: true,
  hasClientSecret: true,
  hasRefreshToken: true,
  refreshTokenLength: 103
}
Initializing Drive service with refresh token length: 103
Drive authentication error: invalid_client undefined
Drive testConnection error: Drive authentication failed: invalid_client undefined
Drive test error: Drive connection test failed: Drive authentication failed: invalid_client Error: Drive connection test failed: Drive authentication failed: invalid_client
    at GoogleDriveService.testConnection (/var/www/html/backup/bk/src/server/drive.ts:732:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at <anonymous> (/var/www/html/backup/bk/src/server/index.ts:1247:29)
Failed to upload local_backups_db-dump-all.sql: Error: Failed to upload file: request to https://www.googleapis.com/upload/drive/v3/files?fields=id%2Cname%2CmimeType%2Csize%2CmodifiedTime%2Cparents%2CwebViewLink&uploadType=multipart failed, reason: connect ETIMEDOUT 216.58.209.138:443
    at GoogleDriveService.uploadFile (/var/www/html/backup/bk/src/server/drive.ts:196:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at GoogleDriveService.uploadDirectory (/var/www/html/backup/bk/src/server/drive.ts:287:34)
    at BackupManager.run (/var/www/html/backup/bk/src/server/backup.ts:329:42)
[Backup 56] Google Drive auto-upload completed successfully. Uploaded items: 2
